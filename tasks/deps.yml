---

- name: Add source repository into sources list
  become: true
  ansible.builtin.apt_repository:
    # yamllint disable-line rule:line-length
    repo: deb-src http://archive.ubuntu.com/ubuntu/ {{ ansible_distribution_release }} main
    state: present

- name: Update APT sources
  become: true
  ansible.builtin.apt:
    update_cache: true

# yamllint disable-line rule:line-length
# See https://devguide.python.org/getting-started/setup-building/#install-dependencies
- name: Dependencies Python | Install build time dependencies
  become: true
  ansible.builtin.apt:
    state: build-dep
    name:
      - python3

# yamllint disable-line rule:line-length
# Again, see https://devguide.python.org/getting-started/setup-building/#install-dependencies
- name: Dependencies Python | Install compile time dependencies
  become: true
  ansible.builtin.apt:
    state: present
    name:
      - build-essential
      - gdb
      - lcov
      - libbz2-dev
      - libffi-dev
      - libgdbm-dev
      - libgdbm-compat-dev
      - liblzma-dev
      - libncurses5-dev
      - libreadline6-dev
      - libsqlite3-dev
      - libssl-dev
      - libzstd-dev
      - lzma
      - lzma-dev
      - pkg-config
      - tk-dev
      - uuid-dev
      - xz-utils
      - zlib1g-dev

- name: Dependencies Python 3.6 | Install compile time dependencies
  become: true
  ansible.builtin.apt:
    state: present
    name:
      - liblzma-dev
  when: python_36

##
# Pillow
##

- name: Dependencies Pillow | Install compile time dependencies
  become: true
  ansible.builtin.apt:
    state: present
    name:
      - cmake
      - libfreetype6-dev
      - libjpeg8-dev
      - liblcms2-dev
      - libtiff5-dev
      - libwebp-dev
      - tcl8.6-dev
      - tk8.6-dev
  when: pillow

##
# lxml
##

- name: Dependencies lxml | Install compile time dependencies
  become: true
  ansible.builtin.apt:
    state: present
    name:
      - libxml2
      - libxml2-dev
      - libxslt1.1
      - libxslt1-dev
  when: lxml
